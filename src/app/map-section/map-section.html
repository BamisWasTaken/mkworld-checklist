<section #mapSection class="relative w-full h-auto rounded-lg shadow overflow-hidden z-50">
  <mkworld-settings [visibleCollectibleChecklistModels]="visibleCollectibleChecklistModels()" />
  <div
    id="map-panzoom"
    #mapPanzoom
    class="w-full h-full relative"
    (contextmenu)="$event.preventDefault()"
  >
    <img
      ngSrc="/imgs/map.webp"
      alt="Mario Kart World Map"
      class="cursor-grab"
      width="2580"
      height="2580"
      [class.cursor-grabbing]="isPanning"
      priority
    />
    @for (
      collectibleChecklistModel of visibleCollectibleChecklistModels();
      track collectibleChecklistModel.index
    ) {
      <div
        id="collectible-div-{{ collectibleChecklistModel.index }}"
        class="collectible absolute"
        [class.hovered]="hovered() === collectibleChecklistModel"
        [class.disappearing]="collectibleChecklistModel.disappearingFromMap"
        [class.collected]="collectibleChecklistModel.checked"
        [class.opacity-50]="
          activeTooltipData() && activeTooltipData()!.index !== collectibleChecklistModel.index
        "
        [style.--target-scale]="
          activeTooltipData()?.index === collectibleChecklistModel.index ||
          hovered() === collectibleChecklistModel
            ? 1.2 * collectibleScale()
            : collectibleScale()
        "
        [ngStyle]="{
          left: collectibleChecklistModel.collectibleModel!.xPercentage + '%',
          top: collectibleChecklistModel.collectibleModel!.yPercentage + '%',
        }"
        [attr.data-collectible-index]="collectibleChecklistModel.index"
        (mouseenter)="hovered.set(collectibleChecklistModel)"
        (mouseleave)="hovered.set(null)"
        (click)="onClick(collectibleChecklistModel)"
        tabindex="0"
        role="button"
        [attr.aria-label]="
          'MAP_SECTION.COLLECTIBLE_MARKER_ARIA_LABEL'
            | translate: { index: collectibleChecklistModel.index }
        "
      >
        <img
          [ngSrc]="`/imgs/${collectibleChecklistModel.collectibleModel?.collectibleType}.webp`"
          [alt]="collectibleChecklistModel.collectibleModel!.collectibleType + ' marker'"
          [height]="
            collectibleChecklistModel.collectibleModel!.collectibleType === CollectibleType.P_SWITCH
              ? 12.5
              : 20
          "
          width="20"
          class="collectible-img"
          draggable="false"
        />
      </div>
    }

    @if (activeTooltipData(); as tooltipData) {
      <div
        class="map-tooltip-container absolute z-20"
        [style.left.%]="activeTooltipData()!.collectibleModel!.xPercentage"
        [style.top.%]="activeTooltipData()!.collectibleModel!.yPercentage"
      >
        <div [style.transform]="tooltipTransform()">
          <mkworld-tooltip [checklistModel]="tooltipData" [position]="tooltipPosition()" />
        </div>
      </div>
    }
  </div>
</section>
