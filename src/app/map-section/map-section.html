<section class="relative w-full h-auto max-h-[767px] rounded-lg shadow overflow-hidden">
  <div
    class="absolute top-2 right-2 z-10 flex items-center gap-2 p-2 rounded-md bg-white/70 backdrop-blur-sm"
  >
    <label
      for="show-collected-map"
      class="flex items-center gap-2 cursor-pointer group filter-toggle"
    >
      <div
        class="w-4 h-4 border-2 border-gray-400 rounded flex items-center justify-center transition-all duration-200 group-hover:border-gray-500"
        [class.bg-yellow-400]="showCollected()"
        [class.border-yellow-400]="showCollected()"
      >
        <div
          class="w-2 h-2 bg-white rounded-sm transition-transform duration-200"
          [class.scale-100]="showCollected()"
          [class.scale-0]="!showCollected()"
        ></div>
      </div>
      <span
        class="text-sm text-gray-600 group-hover:text-gray-700 transition-colors duration-200 select-none"
      >
        {{ 'MAP_SECTION.SHOW_COLLECTED' | translate }}
      </span>
      <input
        id="show-collected-map"
        type="checkbox"
        class="sr-only"
        [checked]="showCollected()"
        (change)="toggleShowCollected()"
      />
    </label>
  </div>
  <div
    id="map-panzoom"
    #mapPanzoom
    class="w-full h-full relative"
    (contextmenu)="$event.preventDefault()"
  >
    <img
      src="/imgs/map.png"
      alt="Mario Kart World Map"
      class="w-full h-full cursor-grab"
      [class.cursor-grabbing]="isPanning"
    />
    @for (
      collectibleChecklistModel of collectibleChecklistModels();
      track collectibleChecklistModel.index
    ) {
      @if (
        !collectibleChecklistModel.checked ||
        collectibleChecklistModel.disappearing ||
        showCollected()
      ) {
        <div
          id="collectible-div-{{ collectibleChecklistModel.index }}"
          class="collectible absolute ready"
          [class.hovered]="hovered() === collectibleChecklistModel"
          [class.disappearing]="collectibleChecklistModel.disappearing && !showCollected()"
          [style.--target-scale]="
            focusedCollectibleIndex() === collectibleChecklistModel.index ||
            hovered() === collectibleChecklistModel
              ? 1.2
              : 1
          "
          [ngStyle]="{
            left: collectibleChecklistModel.collectibleModel!.xPercentage + '%',
            top: collectibleChecklistModel.collectibleModel!.yPercentage + '%',
          }"
          [attr.data-collectible-index]="collectibleChecklistModel.index"
          (mouseenter)="hovered.set(collectibleChecklistModel)"
          (mouseleave)="hovered.set(null)"
          (click)="onClick(collectibleChecklistModel)"
          tabindex="0"
          role="button"
          aria-label="Collectible marker"
        >
          <img
            [src]="`/imgs/${collectibleChecklistModel.collectibleModel?.collectibleType}${collectibleChecklistModel.checked ? '-collected' : ''}.png`"
            [alt]="collectibleChecklistModel.collectibleModel!.collectibleType + ' marker'"
            class="collectible-img"
            draggable="false"
          />
        </div>
      }
    }

    @if (activeTooltipData(); as tooltipData) {
      <div
        class="map-tooltip-container absolute z-20"
        [style.left.%]="activeTooltipData()!.collectibleModel!.xPercentage"
        [style.top.%]="activeTooltipData()!.collectibleModel!.yPercentage"
      >
        <div [style.transform]="tooltipTransform()">
          <mkworld-tooltip
            [checklistModel]="tooltipData"
            [position]="tooltipPosition()?.position ?? 'above'"
          />
        </div>
      </div>
    }
  </div>
</section>
