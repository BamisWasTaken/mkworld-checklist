<section
  #mapSection
  class="relative w-full h-auto shadow overflow-hidden z-50"
  [class.rounded-lg]="!isFullscreen"
>
  <mkworld-settings [visibleCollectibleChecklistModels]="visibleCollectibleChecklistModels()" />

  <!-- Fullscreen Button (Mobile Only) -->
  <button
    class="fullscreen-toggle absolute bottom-2 right-2 z-20 flex items-center justify-center w-12 h-12 rounded-full bg-white backdrop-blur-sm shadow-lg hover:bg-gray-200 transition-all duration-200 cursor-pointer sm:hidden"
    (click)="toggleFullscreen()"
    [attr.aria-label]="'MAP_SECTION.FULLSCREEN_TOGGLE' | translate"
  >
    <span class="material-symbols-outlined text-2xl text-gray-700 transition-all duration-200">
      fullscreen
    </span>
  </button>

  <div
    id="map-panzoom"
    #mapPanzoom
    class="w-full h-full relative"
    [class.fullscreen-map-panzoom]="isFullscreen"
    (contextmenu)="$event.preventDefault()"
  >
    <img
      ngSrc="/imgs/map.webp"
      alt="Mario Kart World Map"
      class="cursor-grab"
      width="2580"
      height="2580"
      [class.cursor-grabbing]="isPanning"
      priority
    />
    @for (
      collectibleChecklistModel of visibleCollectibleChecklistModels();
      track collectibleChecklistModel.index
    ) {
      <div
        id="collectible-div-{{ collectibleChecklistModel.index }}"
        class="collectible absolute"
        [class.hovered]="hovered() === collectibleChecklistModel"
        [class.disappearing]="collectibleChecklistModel.disappearingFromMap"
        [class.collected]="collectibleChecklistModel.checked"
        [class.opacity-50]="
          activeTooltipData() && activeTooltipData()!.index !== collectibleChecklistModel.index
        "
        [style.--target-scale]="
          activeTooltipData()?.index === collectibleChecklistModel.index ||
          hovered() === collectibleChecklistModel
            ? 1.2 * collectibleScale()
            : collectibleScale()
        "
        [ngStyle]="{
          left: collectibleChecklistModel.collectibleModel!.xPercentage + '%',
          top: collectibleChecklistModel.collectibleModel!.yPercentage + '%',
        }"
        [attr.data-collectible-index]="collectibleChecklistModel.index"
        (mouseenter)="hovered.set(collectibleChecklistModel)"
        (mouseleave)="hovered.set(null)"
        (click)="onClick(collectibleChecklistModel)"
        tabindex="0"
        role="button"
        [attr.aria-label]="
          'MAP_SECTION.COLLECTIBLE_MARKER_ARIA_LABEL'
            | translate: { index: collectibleChecklistModel.index }
        "
      >
        <img
          [ngSrc]="`/imgs/${collectibleChecklistModel.collectibleModel?.collectibleType}.webp`"
          [alt]="collectibleChecklistModel.collectibleModel!.collectibleType + ' marker'"
          [height]="
            collectibleChecklistModel.collectibleModel!.collectibleType === CollectibleType.P_SWITCH
              ? 12.5
              : 20
          "
          width="20"
          class="collectible-img"
          draggable="false"
        />
      </div>
    }

    @if (activeTooltipData(); as tooltipData) {
      <div
        class="map-tooltip-container absolute z-20"
        [style.left.%]="activeTooltipData()!.collectibleModel!.xPercentage"
        [style.top.%]="activeTooltipData()!.collectibleModel!.yPercentage"
      >
        <div [style.transform]="tooltipTransform()">
          <mkworld-tooltip [checklistModel]="tooltipData" [position]="tooltipPosition()" />
        </div>
      </div>
    }
  </div>
</section>
