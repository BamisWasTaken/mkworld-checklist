<section
  class="w-full rounded-lg shadow relative flex flex-col items-center overflow-hidden sticker-album-container"
>
  <div class="w-full p-4 flex flex-col items-center">
    <!-- Toggle for collected stickers -->
    <div class="absolute top-2 right-3 flex items-center gap-2">
      <label
        class="flex items-center gap-2 cursor-pointer group filter-toggle"
        [class.opacity-50]="areControlsDisabled()"
        [class.cursor-not-allowed]="areControlsDisabled()"
        [class.cursor-pointer]="!areControlsDisabled()"
      >
        <div
          class="w-4 h-4 border-2 border-gray-400 rounded flex items-center justify-center transition-all duration-200 group-hover:border-gray-500"
          [class.bg-yellow-400]="showCollectedStickers()"
          [class.border-yellow-400]="showCollectedStickers()"
        >
          <div
            class="w-2 h-2 bg-white rounded-sm transition-transform duration-200"
            [class.scale-100]="showCollectedStickers()"
            [class.scale-0]="!showCollectedStickers()"
          ></div>
        </div>
        <span
          class="text-sm text-gray-600 group-hover:text-gray-700 transition-colors duration-200"
        >
          {{ 'STICKER_ALBUM.SHOW_COLLECTED_STICKERS' | translate }}
        </span>
        <input
          type="checkbox"
          class="sr-only"
          [checked]="showCollectedStickers()"
          (change)="toggleShowCollectedStickers()"
          [disabled]="areControlsDisabled()"
        />
      </label>
    </div>

    <img
      ngSrc="/imgs/page-arrow-left.webp"
      [alt]="'STICKER_ALBUM.PREVIOUS_PAGE_ALT_TEXT' | translate"
      width="30"
      height="33"
      class="absolute left-3 top-1/2 -translate-y-1/2 cursor-pointer transition-transform duration-300 hover:scale-110 z-10 arrow-button"
      [class.opacity-50]="areControlsDisabled()"
      [class.cursor-not-allowed]="areControlsDisabled()"
      [class.cursor-pointer]="!areControlsDisabled()"
      [class.hover:scale-110]="!areControlsDisabled()"
      (click)="prevPage()"
      draggable="false"
    />
    <img
      ngSrc="/imgs/page-arrow-right.webp"
      [alt]="'STICKER_ALBUM.NEXT_PAGE_ALT_TEXT' | translate"
      width="30"
      height="33"
      class="absolute right-3 top-1/2 -translate-y-1/2 cursor-pointer transition-transform duration-300 hover:scale-110 z-10 arrow-button"
      [class.opacity-50]="areControlsDisabled()"
      [class.cursor-not-allowed]="areControlsDisabled()"
      [class.cursor-pointer]="!areControlsDisabled()"
      [class.hover:scale-110]="!areControlsDisabled()"
      (click)="nextPage()"
      draggable="false"
    />
  </div>

  <!-- Sticker grid container - no padding, full width -->
  <div class="relative w-full overflow-hidden">
    <div #pageContainer class="w-full page-container">
      <div
        class="grid lg:grid-cols-8 lg:grid-rows-4 grid-cols-5 grid-rows-5 gap-x-4 lg:gap-y-6 gap-y-2 mt-2 mb-2 w-full select-none lg:px-14 px-12 sticker-grid"
      >
        @for (checklistModel of page; track checklistModel.index) {
          <div
            #stickerItem
            [id]="'sticker-' + checklistModel.index"
            class="flex flex-col items-center cursor-pointer transition-scale duration-200 sticker"
            [class.scale-110]="hoveredChecklistModel()?.index === checklistModel.index"
            [class.disappearing]="
              checklistModel.disappearingFromStickerAlbum && !showCollectedStickers()
            "
            (mouseenter)="onStickerHover(true, checklistModel)"
            (mouseleave)="onStickerHover(false, checklistModel)"
            (click)="onStickerClick($event, checklistModel)"
          >
            <div
              class="lg:w-24 lg:h-24 w-16 h-16 flex items-center justify-center transition-opacity duration-200"
              [class.opacity-50]="checklistModel.checked"
            >
              <img
                [ngSrc]="'/imgs/stickers/sticker-' + checklistModel.index + '.webp'"
                [alt]="'STICKERS.' + checklistModel.stickerAltText | translate"
                class="object-contain"
                draggable="false"
                fill
              />
            </div>
            <input
              type="checkbox"
              class="absolute top-0 right-0 sticker-checkbox"
              [checked]="checklistModel.checked"
              (change)="onStickerChecked(checklistModel)"
              (click)="$event.stopPropagation()"
              aria-label="STICKER_ALBUM.STICKER.TOGGLE_STICKER_COLLECTED_ALT_TEXT"
            />
          </div>
        }
      </div>
    </div>
  </div>

  <!-- Description display section -->
  <div class="w-full px-4 mb-3 md:h-14 h-10 description-display flex items-center justify-center">
    <div
      class="relative 2xl:w-[60%] lg:w-[75%] md:w-[80%] w-[90%] h-full transition-opacity duration-300 ease-in-out"
      [class.opacity-100]="hoveredChecklistModel() || tooltipSticker()"
      [class.opacity-0]="!hoveredChecklistModel() && !tooltipSticker()"
    >
      <img
        ngSrc="/imgs/description-background.webp"
        [alt]="'STICKER_ALBUM.DESCRIPTION_BACKGROUND_ALT_TEXT' | translate"
        draggable="false"
        fill
      />
      <div class="absolute inset-0 flex items-center justify-center px-6">
        <p
          class="text-white text-center font-medium leading-tight description-text lg:text-2xl sm:text-lg text-sm"
        >
          {{
            tooltipSticker()
              ? ('STICKERS.' + tooltipSticker()?.description | translate)
              : hoveredChecklistModel()
                ? ('STICKERS.' + hoveredChecklistModel()?.description | translate)
                : ''
          }}
        </p>
      </div>
    </div>
  </div>

  <div class="flex flex-wrap justify-center gap-2 mb-3 px-2">
    @for (dot of [].constructor(pageCount()); track $index) {
      <span
        class="w-3 h-3 rounded-full transition-all duration-200 flex-shrink-0"
        [class.bg-yellow-400]="$index === pageNumber()"
        [class.bg-gray-800]="$index !== pageNumber()"
        [class.opacity-80]="$index === pageNumber()"
        [class.opacity-50]="$index !== pageNumber()"
        [class.cursor-not-allowed]="areControlsDisabled()"
        [class.cursor-pointer]="!areControlsDisabled()"
        [class.active-page-dot]="$index === pageNumber()"
        (click)="goToPage($index)"
      ></span>
    }
  </div>
</section>

@if (tooltipText() && tooltipPosition()) {
  <div
    class="sticker-tooltip fixed z-50 flex flex-col items-center"
    [class.tooltip-above]="tooltipPositionAbove()"
    [class.tooltip-below]="!tooltipPositionAbove()"
    [style.left.px]="tooltipPosition()!.x"
    [style.top.px]="tooltipPosition()!.y"
  >
    <!-- Triangle pointing up (when tooltip is below) -->
    @if (!tooltipPositionAbove()) {
      <div
        class="w-0 h-0 border-l-[8px] border-l-transparent border-r-[8px] border-r-transparent border-b-[8px] border-b-gray-800 -mb-px"
      ></div>
    }

    <!-- Tooltip content box -->
    <div
      class="relative lg:max-w-[300px] max-w-[200px] bg-gray-800 text-white rounded-md shadow-lg"
    >
      <div class="flex items-center px-4 py-2">
        <p class="pr-2 text-center lg:text-lg text-md">
          {{ 'STICKERS.' + tooltipText()! | translate }}
        </p>
        <button
          class="flex-shrink-0 flex justify-center items-center w-5 h-5 rounded-full text-white hover:bg-gray-700 transition-colors"
          (click)="closeTooltip()"
          aria-label="STICKER_ALBUM.CLOSE_TOOLTIP_ALT_TEXT"
        >
          <span class="text-xl leading-none -mt-[3px]">&times;</span>
        </button>
      </div>
    </div>

    <!-- Triangle pointing down (when tooltip is above) -->
    @if (tooltipPositionAbove()) {
      <div
        class="w-0 h-0 border-l-[8px] border-l-transparent border-r-[8px] border-r-transparent border-t-[8px] border-t-gray-800 -mt-[2px]"
      ></div>
    }
  </div>
}
